@inherits LayoutComponentBase

@implements IDisposable

@inject ISnackbar Snackbar
@inject MainLayoutViewModel ViewModel

<MudThemeProvider Theme="App.Theme" />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MainAppBar />
    <NavMenu />
    <MudMainContent>
        @Body
    </MudMainContent>
</MudLayout>

@code {

    readonly CompositeDisposable disposables = new();

    protected override void OnParametersSet() {
        ViewModel.Notifications
                 .Subscribe(m => Snackbar.Add(m.Message, m.Severity,
                      m.Severity is Severity.Error or Severity.Warning ? RequireInteraction : null))
                 .DisposeWith(disposables);
        base.OnParametersSet();
    }

    void RequireInteraction(SnackbarOptions opts) => opts.RequireInteraction = true;

    public void Dispose() {
        disposables.Dispose();
    }

}